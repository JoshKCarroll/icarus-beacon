global:
    default_order: function() { return feature.sort_key || 0; }

fonts:
    Montserrat:
        url: https://fonts.gstatic.com/s/montserrat/v7/zhcz-_WihjSQC0oHJ9TCYL3hpw3pgy2gAi-Ip7WPMi0.woff
    Open Sans:
        - weight: 300
          url: fonts/open sans-300normal.ttf
        - weight: 300
          style: italic
          url: fonts/open sans-300italic.ttf

scene:
    background:
        color: '#000000'
cameras:
    camera1:
        position: [-119.2065, 40.7864, 14.2]
        type: flat
        axis: [1,1]
        active: true


styles:
    flatcolor:
        base: polygons
        lighting: false
    heightglow:
        base: polygons
        lighting: vertex
        shaders:
            blocks:
                color: "color.rgb += vec3(worldPosition().z / 800.);"
    heightglowline:
        base: lines
        mix: heightglow
    icons:
        base: points
        texture: pois
    dashes:
        base: lines
        dash: [1, 1]
        dash_background_color: lightgrey

sources:
    osm:
        type: MVT
        url:  https://vector.mapzen.com/osm/all/{z}/{x}/{y}.mvt
        max_zoom: 16
        url_params:
            api_key: vector-tiles-tyHL4AY

    overlay:
        type: GeoJSON
        url: brc-map.json

layers:
    # earth:
    #     data: { source: osm }
    #     draw:
    #         polygons:
    #             order: 0
    #             color: '#000000'

    fence:
        data: { source: overlay }
        draw:
            lines:
                order: 2
                color: '#ffffff'

    roads:
        data: { source: overlay }
        filter:
            not: { kind: [rail] }
        draw:
            lines:
                color: green
                width: 12.
                order: 'function() { return feature.sort_key + 5 || 0 }'
                #outline:
                #    color: [[16, '#999'], [18, '#aaa']]
                #    width: [[10, 0], [16, 2]]

        rounded:
            filter: { $zoom: { min: 18 } }
            draw:
                lines:
                    cap: round
        highway:
            filter: { kind: highway }
            draw:
                lines:
                    color: '#D16768'
                    width: [[14, 2px], [15, 12]]
                    outline:
                        width: [[14, 0], [15, 2]]
            link:
                filter: { is_link: yes }
                draw:
                    lines:
                        color: '#aaa'
                        width: [[13, 1px], [14, 12]]
        major_road:
            filter: { kind: major_road, $zoom: { min: 10 } }
            draw:
                lines:
                    color: '#aaaaa4'
                    width: [[10, 1px], [13, 2px], [14, 2px], [16, 12]]
                    outline:
                        width: [[16, 0], [17, 1]]
        minor_road:
            filter: { kind: minor_road }
            draw:
                lines:
                    color: '#bbbbb8'
                    width: [[13, 1px], [14, 1px], [15, 8]]
                    outline:
                        width: [[17, 0], [18, 1]]
        paths:
            filter: { kind: path }
            draw:
                lines:
                    color: '#fff'
                    width: [[15, 1px], [17, 2px]]
                    outline:
                        width: 0
        airports:
            filter: { aeroway: true }
            draw:
                lines:
                    color: '#f00'
            taxiways:
                filter: { aeroway: taxiway }
                draw:
                    lines:
                        width: [[13, 1px], [14, 2.0], [17, 5.0]]
            runways:
                filter: { aeroway: runway }
                draw:
                    lines:
                        color: [[13, '#FFE4B5'], [16, white]]
                        width: [[11, 2.], [12, 3.], [13, 4.], [17, 8.]]
                        order: 39
                        cap: square
                        outline:
                            color: orange
                            width: [[11, 0], [12, 1.], [17, 2.]]

    poi_icons:
        data: { source: osm, layer: pois }
        filter: { name: true, not: { kind: [peak, viewpoint, bicycle_rental, car_sharing] }, $zoom: { min: 15 } }
        draw:
            icons:
                interactive: true
                #offset: [0px, -15px]
                size: 20px
                priority: 5
                collide: true
                transition:
                    [show, hide]:
                        time: 1s
                #size: [[13, 12px], [15, 18px]]
                #interactive: true
                text:
                    required: true
                    interactive: true
                    text_wrap: 20
                    font:
                        family: sans-serif
                        weight: 400
                        style: normal
                        size: 1.2em
                        fill: white
        # add generic icon at high zoom
        generic:
            filter: { $zoom: { min: 18 } }
            draw:
                icons:
                    sprite: function() { return feature.kind; }
                    sprite_default: info
                    #sprite: info

        # examples of different icons mapped to feature properties
        icons:
            restaurant:
                filter: { kind: [restaurant] }
                draw: { icons: { sprite: restaurant } }
            cafe:
                filter: { kind: [cafe, convenience] }
                draw: { icons: { sprite: cafe } }
            bar:
                filter: { kind: [bar, pub] }
                draw: { icons: { sprite: bar } }
            culture:
                filter: { kind: [museum, library, church, place_of_worship, bank] }
                draw: { icons: { sprite: museum } }
            station:
                filter: { kind: [station] }
                draw: { icons: { sprite: train } }
            hospital:
                filter: { kind: [hospital, pharmacy] }
                draw: { icons: { sprite: hospital } }
            hotel:
                filter: { kind: [hotel, hostel] }
                draw: { icons: { sprite: hotel } }
            bus_stop:
                filter: { kind: [bus_stop] }
                draw: { icons: { sprite: bus } }
            bookstore:
                filter: { kind: [bookstore] }
                draw: { icons: { sprite: bookstore } }

    # poi_labels:
    #     data: { source: osm, layer: pois }
    #     filter: { name: true, not: { kind: [peak, viewpoint, bicycle_rental, car_sharing] }, $zoom: { min: 15 } }
    #     draw:
    #         text:
    #             interactive: true
    #             #offset: [0, 12px]
    #             align: right
    #             text_wrap: 20
    #             font:
    #                 family: sans-serif
    #                 weight: 400
    #                 style: normal
    #                 size: 1.2em
    #                 fill: white
    road_labels:
        data: {source: overlay, layer: roads}
        filter: { name: true, aeroway: false, tunnel: false, railway: false, not: { kind: rail }, $zoom: { min: 10 } }
        draw:
            text:
                interactive: true
                visible: true
                priority: 2
                # offset: [0, 8px]
                transition:
                    [show, hide]:
                        time: 1s
                font:
                    family: sans-serif
                    weight: 400
                    style: normal
                    size: 1.em
                    fill: black
                    stroke: { color: white, width: 2 }
        highway:
            filter: { kind: highway }
            draw:
                text:
                    repeat_distance: 200px
                    repeat_group: road_labels
                    visible: true
                    #offset: [0px, 5px]
                    priority: 1
                    transition:
                        [show, hide]:
                            time: 1s
                    font:
                        family: sans-serif
                        weight: 400
                        style: normal
                        size: 18px
                        fill: black
                        transform: capitalize
        major_road:
            filter: { kind: major_road }
            draw:
                text:
                    repeat_distance: 100px
                    repeat_group: roads
                    interactive: true
                    visible: true
                    priority: 3
                    transition:
                        [show, hide]:
                            time: 1s
                    font:
                        family: sans-serif
                        weight: 400
                        style: normal
                        size: 14.5pt

    pois:
        data: { source: osm }
        draw:
            icons: {}
